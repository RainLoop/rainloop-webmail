/*
 * Copyright Â© 2019 Denis Vadimov aka BloodyAltair
 */

/**
 * @see https://github.com/BloodyAltair/UnsplashBackgroundUpdater/blob/master/unsplashbg.js
 */
(function () {
    window.unsplashBgUpdater={init:function(e,t,a,n,s){if("function"==typeof window.fetch){switch("function"==typeof n?unsplashBgUpdater.getData=n:unsplashBgUpdater.url=n||unsplashBgUpdater.url,unsplashBgUpdater.url_postfix=s||unsplashBgUpdater.url_postfix,unsplashBgUpdater.interval=e||unsplashBgUpdater.interval,unsplashBgUpdater.insert=t||unsplashBgUpdater.insert,unsplashBgUpdater.type=a||unsplashBgUpdater.type,unsplashBgUpdater.type){case"tag":var r=document.getElementsByTagName(unsplashBgUpdater.insert)[0];break;case"id":r=document.getElementById(unsplashBgUpdater.insert);break;case"class":r=document.getElementsByClassName(unsplashBgUpdater.insert)[0];break;default:return console.log("Unable to update Unsplash BG. Error: Invalid element to insert BG: ",unsplashBgUpdater),clearInterval(unsplashBgUpdater.timer),1}unsplashBgUpdater.mainElement=document.createElement("div"),unsplashBgUpdater.mainElement.id="unsplash_bg_updater_main_element",unsplashBgUpdater.mainElement.className=r.className,unsplashBgUpdater.mainElement.style=r.style,unsplashBgUpdater.mainElement.attributes=r.attributes,document.body.appendChild(unsplashBgUpdater.mainElement);var p=Number.isInteger(getComputedStyle(r).zIndex)?getComputedStyle(r).zIndex:-1e3,i=document.getElementsByTagName("head")[0],l=document.createElement("link"),o=document.createElement("style"),d=document.createElement("script");switch(d.src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.2.0/anime.min.js",d.integrity="sha256-BuxrUdr/4YoztQLxT6xmdO6hSQw2d6BtBUY1pteGds4=",d.crossOrigin="anonymous",d.defer=!0,l.rel="stylesheet",l.type="text/css",l.href="https://fonts.googleapis.com/css?family=Nanum+Brush+Script",l.media="all",i.appendChild(l),i.appendChild(d),o.type="text/css",unsplashBgUpdater.type){case"tag":var u=unsplashBgUpdater.insert;break;case"id":u="#"+unsplashBgUpdater.insert;break;case"class":u="."+unsplashBgUpdater.insert;break;default:return console.log("Unable to update Unsplash BG. Error: Unable to get css selector type: ",unsplashBgUpdater),1}unsplashBgUpdater.css=unsplashBgUpdater.css.replace("tag_insert",u),unsplashBgUpdater.css=unsplashBgUpdater.css.replace(/interval/gi,unsplashBgUpdater.interval),unsplashBgUpdater.css=unsplashBgUpdater.css.replace(/zindexbg/gi,p),o.styleSheet?o.styleSheet.cssText=unsplashBgUpdater.css:o.appendChild(document.createTextNode(unsplashBgUpdater.css)),i.appendChild(o),unsplashBgUpdater.tag_insert="unsplash_bg_updater_main_element",unsplashBgUpdater.type="id",unsplashBgUpdater.fakeElement=document.createElement("div"),unsplashBgUpdater.fakeElement.id="unsplash_bg_updater_fake_element",unsplashBgUpdater.fakeElement.className=unsplashBgUpdater.mainElement.className,unsplashBgUpdater.fakeElement.style=unsplashBgUpdater.mainElement.style,unsplashBgUpdater.fakeElement.attributes=unsplashBgUpdater.mainElement.attributes,document.all?unsplashBgUpdater.fakeElement.style.setAttribute("cssText","background: transparent !important"):unsplashBgUpdater.fakeElement.setAttribute("style","background: transparent !important"),document.body.appendChild(unsplashBgUpdater.fakeElement),document.all?r.style.setAttribute("cssText","z-index: "+(p-1)+";"):r.setAttribute("style","z-index: "+(p-1)+";"),unsplashBgUpdater.check_tab_active(function(){console.log(unsplashBgUpdater.check_tab_active()?"Tab is visible now, script will continue updates":"Tab is not visible, skipping updates")}),unsplashBgUpdater.updater(),unsplashBgUpdater.timer=setInterval(function(){unsplashBgUpdater.updater()},1e3*unsplashBgUpdater.interval)}else console.log("window.fetch() is absent, updater will exit")},updater:function(){!0===unsplashBgUpdater.check_tab_active()&&unsplashBgUpdater.getData().then(function(t){"true"==t.success.toString()?(unsplashBgUpdater._image=new Image,unsplashBgUpdater._image.crossOrigin="anonymous",unsplashBgUpdater._image.onload=function(){var e=unsplashBgUpdater.get_image_brightness(this);unsplashBgUpdater.update_bg(t.url+unsplashBgUpdater.url_postfix,e),unsplashBgUpdater.update_copyright(t.image_user_name,t.image_user_url+unsplashBgUpdater.url_postfix)},unsplashBgUpdater._image.src=t.url+unsplashBgUpdater.url_postfix):(console.log("Unable to update Unsplash BG. Response was not successful: ",t.error.toString()),clearInterval(unsplashBgUpdater.timer))}).catch(function(e){console.log("Unable to update Unsplash BG. Error: ",e),clearInterval(unsplashBgUpdater.timer)})},getData:function(){return fetch(unsplashBgUpdater.url,unsplashBgUpdater.fetch_opts).then(function(e){return e.json()})},update_bg:function(e,t){0==unsplashBgUpdater.roll?(document.all?unsplashBgUpdater.fakeElement.style.setAttribute("cssText","background: linear-gradient(rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+"), rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+')),rgba(34, 45, 50, 0.7) url("'+e+'") no-repeat center fixed !important;background-size: cover !important;'):unsplashBgUpdater.fakeElement.setAttribute("style","background: linear-gradient(rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+"), rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+')), rgba(34, 45, 50, 0.7) url("'+e+'") no-repeat center fixed !important;background-size: cover !important;'),anime({targets:"#unsplash_bg_updater_fake_element",opacity:[0,1],duration:4e3,easing:"easeInOutQuart"}),anime({targets:"#unsplash_bg_updater_main_element",opacity:[1,0],duration:4e3,easing:"easeInOutQuart"}),unsplashBgUpdater.roll=1):(document.all?unsplashBgUpdater.mainElement.style.setAttribute("cssText","background: linear-gradient(rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+"), rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+')),rgba(34, 45, 50, 0.7) url("'+e+'") no-repeat center fixed !important;background-size: cover !important;'):unsplashBgUpdater.mainElement.setAttribute("style","background: linear-gradient(rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+"), rgba(0, 0, 0, "+(t/255).toFixed(4).toString()+')), rgba(34, 45, 50, 0.7) url("'+e+'") no-repeat center fixed !important;background-size: cover !important;'),anime({targets:"#unsplash_bg_updater_main_element",opacity:[0,1],duration:4e3,easing:"easeInOutQuart"}),anime({targets:"#unsplash_bg_updater_fake_element",opacity:[1,0],duration:4e3,easing:"easeInOutQuart"}),unsplashBgUpdater.roll=0)},update_copyright:function(e,t){var a=document.getElementsByClassName("unsplash_bg_updater_copyright"),n=document.getElementsByTagName("body")[0];0==Object.values(a).length?(a=document.createElement("div"),(unsplashBgUpdater.copyright=a).addEventListener("click",function(){unsplashBgUpdater.hide_copyright()})):a=a[0],a.innerHTML='Background by <strong><span><a href="'+t+'">@'+e+'</a></span></strong> from <span><a href="https://unsplash.com">Unsplash.com</a></span>',a.className="unsplash_bg_updater_copyright",0==Object.values(a).length&&n.appendChild(a)},hide_copyright:function(){unsplashBgUpdater.copyright.className+=" unsplash_bg_updater_copyright_hidden"},check_tab_active:function(){var t,a,e={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(t in e)if(t in document){a=e[t];break}return function(e){return e&&document.addEventListener(a,e),!document[t]}}(),get_image_brightness:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");a.drawImage(e,0,0);for(var n,s,r,p=a.getImageData(0,0,t.width,t.height).data,i=0,l=0,o=p.length;l<o;l+=4)n=p[l],s=p[l+1],r=p[l+2],i+=Math.floor((n+s+r)/3);return Math.floor(i/(e.width*e.height))},fetch_opts:{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",redirect:"error"},interval:5,url:"https://bloody.pw/service/unsplash-bg/getUnsplashBg.php",url_postfix:"&utm_source=Bloody%20BG%20Updater&utm_medium=referral",css:"* {          background-blend-mode: initial;}body {           background: rgba(34, 45, 50, 0.9) !important;          pointer-events: all;}.unsplash_bg_updater_copyright {          background-color: rgba(0,0,0,0.78);          max-height: 20%;          position: fixed;          z-index: 10000000000000;          border-radius: 10px;          padding: 0.5%;/*          font-family: 'Nanum Brush Script', cursive;*/          font-family: 'Hack', monospace;          overflow: visible;          bottom: 0;          right: 0;          color: #e6daba;/*          font-size: 18px;*/          font-size: 14px;}.unsplash_bg_updater_copyright > strong > span > a,.unsplash_bg_updater_copyright > strong > span > a:link,.unsplash_bg_updater_copyright > strong > span > a:visited,.unsplash_bg_updater_copyright > strong > span > a:hover,.unsplash_bg_updater_copyright > strong > span > a:active,.unsplash_bg_updater_copyright > strong > span > a:focus {          text-decoration:none !important;          color:#3db930;          border-bottom: 1px dashed #e6daba;          padding-bottom: 2px;}.unsplash_bg_updater_copyright > strong > span > a, .unsplash_bg_updater_copyright > strong > span > a:focus, .unsplash_bg_updater_copyright > strong > span > a:hover, .unsplash_bg_updater_copyright > strong > span > a:active {          border-bottom: 1px dashed #e6daba;          padding-bottom: 2px;          color:#93620d;}.unsplash_bg_updater_copyright > strong > span > a:visited {          border-bottom: initial !important;          padding-bottom: initial !important;          color:#93620d;}#unsplash_bg_updater_main_element {          background-repeat: no-repeat !important;          background-size: 100% !important;          background-position: center !important;          background-clip: border-box !important;          background: rgba(34, 45, 50, 0.7);          backface-visibility: hidden;          opacity: 1;          position: absolute;          pointer-events: all;          top: 0;          left: 0;          bottom: 0;          right: 0;          z-index: calc(zindexbg - 1) !important;}.unsplash_bg_updater_copyright_hidden {          visibility: hidden;          opacity: 0;}#unsplash_bg_updater_fake_element {          background-repeat: no-repeat !important;          background-size: 100% !important;          background-position: center !important;          background-clip: border-box !important;          background: rgba(34, 45, 50, 0.7);          backface-visibility: hidden;          opacity: 0;          position: absolute;          top: 0;          bottom: 0;          left: 0;          right: 0;          pointer-events: all;          z-index: zindexbg !important;}",insert:"body",type:"tag",roll:0};Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&Number.isFinite(e)&&!(e%1)};
}());
